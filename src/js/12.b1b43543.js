(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[12],{"044c":function(t,e,s){"use strict";var o=s("7018"),i=s.n(o);i.a},"06a2":function(t,e,s){},"1c33":function(t,e,s){"use strict";var o=s("896a"),i=s.n(o);i.a},"23be":function(t,e,s){},"2aae8":function(t,e,s){"use strict";var o=s("33e8"),i=s.n(o);i.a},"33e8":function(t,e,s){},3922:function(t,e,s){"use strict";var o=s("ae41"),i=s.n(o);i.a},"3fd8":function(t,e,s){"use strict";var o=s("06a2"),i=s.n(o);i.a},"52f0":function(t,e,s){"use strict";var o=s("23be"),i=s.n(o);i.a},7018:function(t,e,s){},"72a5":function(t,e,s){},"896a":function(t,e,s){},"8e14":function(t,e,s){"use strict";var o=s("72a5"),i=s.n(o);i.a},"918e":function(t,e,s){"use strict";var o=s("fe84"),i=s.n(o);i.a},ae41:function(t,e,s){},cfd2:function(t,e,s){"use strict";var o=s("d431"),i=s.n(o);i.a},d431:function(t,e,s){},e1b0:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("toolbar-page",{attrs:{elements:t.elements,default:"checklist"}})},i=[],a=(s("c880"),s("08e9")),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"full-width row"},[s("div",{staticClass:"col-4 q-mr-lg q-pr-md",staticStyle:{"border-right":"1px solid grey","max-width":"350px"}},[s("div",[s("h1",{staticClass:"text-font-secondary"},[t._v("Before Session Start")]),s("q-list",{staticClass:"text-font",staticStyle:{margin:"auto"},attrs:{bordered:"",dense:""}},[s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Set Deadlines")])],1),s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:t.iconName(t.checklist.deadlines),color:t.iconColor(t.checklist.deadlines)}})],1)],1),t.checklist.deadlines?s("div",{staticClass:"row full-width"},[s("q-badge",{staticClass:"col q-mr-xs q-ml-md",attrs:{color:"font-secondary",outline:""}},[s("q-icon",{staticClass:"q-mr-xs",attrs:{name:"fal fa-bus",outline:"",color:"grey"}}),t._v("\n            "+t._s(t.checklist.deadlineDateTimes.coach)+"\n          ")],1),s("q-badge",{staticClass:"col q-mr-md",attrs:{color:"font-secondary",outline:""}},[s("q-icon",{staticClass:"q-mr-xs",attrs:{name:"fal fa-taxi",outline:"",color:"grey"}}),t._v("\n            "+t._s(t.checklist.deadlineDateTimes.taxi)+"\n          ")],1)],1):t._e(),s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",{staticClass:"text-bold"},[t._v("Check Outbound Stops")])],1),s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:"fal fa-arrow-right"}})],1)],1),s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",{staticClass:"text-bold"},[t._v("Check Return Stops")])],1),s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:"fal fa-arrow-right"}})],1)],1),s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Make Session Active")])],1),s("q-item-section",{attrs:{side:""}},[s("q-btn-toggle",{attrs:{outline:"",readonly:!t.checklist.deadlines,size:"xs","toggle-color":!0===t.checklist.activeSession?"green":"red",options:[{label:"Off",value:!1},{label:"On",value:!0}],"content-style":"font-size:14px"},on:{input:t.setActiveSession},model:{value:t.checklist.activeSession,callback:function(e){t.$set(t.checklist,"activeSession",e)},expression:"checklist.activeSession"}})],1)],1)],1)],1),s("q-separator"),s("div",{staticStyle:{"border-bottom":"1px solid grey"}},[s("h1",{staticClass:"text-font-secondary"},[t._v("Before Self Service")]),s("q-list",{staticClass:"text-font",staticStyle:{margin:"auto"},attrs:{bordered:"",dense:""}},[s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Allocate All Bookings")])],1),s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:t.iconName(t.checklist.allocations),color:t.iconColor(t.checklist.allocations)}})],1)],1),s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Email Confirmations")])],1),s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:t.iconName(t.checklist.confirmations),color:t.iconColor(t.checklist.confirmations)}})],1)],1),s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Start Self Service")])],1),s("q-item-section",{attrs:{side:""}},[s("q-btn-toggle",{attrs:{outline:"",size:"xs","toggle-color":!0===t.checklist.selfService?"green":"red",options:[{label:"Off",value:!1},{label:"On",value:!0}],"content-style":"font-size:14px"},on:{input:t.setSelfService},model:{value:t.checklist.selfService,callback:function(e){t.$set(t.checklist,"selfService",e)},expression:"checklist.selfService"}})],1)],1)],1)],1),s("div",{staticStyle:{"border-bottom":"1px solid grey"}},[s("h1",{staticClass:"text-font-secondary"},[t._v("Before Travel")]),s("q-list",{staticClass:"text-font",staticStyle:{margin:"auto"},attrs:{bordered:"",dense:""}},[s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Assign Supervisors")])],1),s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:t.iconName(t.checklist.supervisors),color:t.iconColor(t.checklist.supervisors)}})],1)],1),s("div",{staticClass:"q-px-sm"},[t._l(t.checklist.unsupervisedCoaches,(function(e){return s("q-btn",{key:e,staticClass:"q-ma-xs q-pa-sx",staticStyle:{"font-size":"12px"},attrs:{label:e,"text-color":"red-7",outline:"",dense:""}},[s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t._v("\n               Supervisor not assigned\n             ")])],1)})),s("br"),t._l(t.checklist.notEmailedCoaches,(function(e){return s("q-btn",{key:e,staticClass:"q-ma-xs q-pa-sx",staticStyle:{"font-size":"12px"},attrs:{label:e,"text-color":"orange",outline:"",dense:""}},[s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t._v("\n             Register not send to supervisor\n           ")])],1)}))],2),s("q-item",{staticClass:"q-my-xs"},[s("q-item-section",[s("q-item-label",[t._v("Email Registers")])],1),s("q-item-section",{attrs:{side:""}},[s("q-btn",{staticStyle:{width:"80px"},attrs:{label:t.registersLabel,color:t.registersColor,outline:"",size:"xs",tooltip:"",loading:t.sendingRegisters},on:{click:t.sendRegisterEmails},scopedSlots:t._u([{key:"loading",fn:function(){return[t._v("\n            Sending...\n          ")]},proxy:!0}])},[s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t._v("\n             Send Unsent Registers\n           ")])],1)],1)],1)],1)],1)],1),s("div",{staticClass:"col text-left row",staticStyle:{"max-width":"800px","overflow-y":"scroll"}},[s("div",{staticClass:"col"},[s("h1",{staticClass:"text-font-secondary"},[t._v("Outbound Stops")]),s("div",{staticClass:"full-width"},t._l(t.checklist.stopsOut,(function(t){return s("q-badge",{key:t.id,staticClass:"q-ma-xs q-pa-sm text-center",staticStyle:{"font-size":"13px","min-width":"300px"},attrs:{label:t.name+" @ "+t.time+" - £"+t.cost,"text-color":"white",color:t.isError?"red-9":"grey",align:"middle",outline:""}})})),1)]),s("div",{staticClass:"col"},[s("h1",{staticClass:"text-font-secondary"},[t._v("Return Stops")]),s("div",{staticClass:"full-width"},t._l(t.checklist.stopsRet,(function(t){return s("q-badge",{key:t.id,staticClass:"q-ma-xs q-pa-sm",staticStyle:{"font-size":"13px","min-width":"300px"},attrs:{label:t.name+" @ "+t.time+" - £"+t.cost,"text-color":"white",color:t.isError?"red-9":"grey",outline:""}})})),1)])])])},r=[],l=s("47783"),c=s("452d"),u={putBooking(t,e,s){l["a"].put("/transport/coaches/bookings",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))},postBooking(t,e,s){l["a"].post("/transport/coaches/bookings",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))},deleteBooking(t,e,s){l["a"].delete("/transport/coaches/bookings/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},declineBooking(t,e,s){l["a"].delete("/transport/coaches/bookings/decline/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getAllBookings(t,e,s){var o=c["a"].getters["transport/activeSession"];l["a"].get("/transport/coaches/bookings/"+o).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getChecklist(t,e){var s=c["a"].getters["transport/activeSession"];l["a"].get("/transport/coaches/checklist/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getAccounts(t,e,s){var o=c["a"].getters["transport/activeSession"];l["a"].get("/transport/coaches/accounts/"+o).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getNewCount(t,e){var s=c["a"].getters["transport/activeSession"];l["a"].get("/transport/coaches/newbookings/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},putCoachAssignment(t,e,s){l["a"].put("/transport/coaches/assignment",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))},putConfirmBooking(t,e,s){l["a"].put("/transport/coaches/confirm",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))}},d=s("9d37"),p=s("5228"),h={name:"Transport.Coaches.Checklist",props:{},data(){return{session:[],checklist:[],sendingRegisters:!1}},methods:{getChecklist(){var t=this;u.getChecklist((function(e){t.checklist=e}),this.$errorHandler)},iconName(t){return!0===t?"fal fa-check":"fal fa-times"},iconColor(t){return!0===t?"green":"red"},setSelfService(t){var e=this,s=!0===t?1:0;d["a"].postSelfService(null,(function(t){e.checklist.selfService=!1}),s)},setActiveSession(t){d["a"].activateSessionFromCheckist((function(){}),(function(){}),t)},sendRegisterEmails(){var t=this;this.sendingRegisters||this.checklist.registers||(this.sendingRegisters=!0,p["a"].postAllRegisterEmails((function(e){t.sendingRegisters=!1,t.getChecklist()}),this.$errorHandler))}},computed:{registersLabel(){return this.checklist.registers?"Done":"Send"},registersColor(){return this.checklist.registers?"green":"red"}},components:{},created(){var t=this;this.session=this.$store.getters["transport/activeSession"],this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.getChecklist),this.$wampSubscribe("coaches.checklist."+this.session,this.getChecklist),this.$wampSubscribe("coaches"+this.session,this.getChecklist),this.$wampSubscribe("routes"+this.session,this.getChecklist),this.getChecklist()}},g=h,m=(s("044c"),s("2be6")),b=s("8c42"),f=s("6c93"),v=s("ac9b"),q=s("66dc"),k=s("7d9a"),x=s("34ff"),C=s("f987"),y=s("6dd6"),w=s("96f0"),_=s("2ef0"),S=s("3aaf"),B=s("e279"),R=s.n(B),I=Object(m["a"])(g,n,r,!1,null,"1fa4d508",null),O=I.exports;R()(I,"components",{QPage:b["a"],QList:f["a"],QItem:v["a"],QItemSection:q["a"],QItemLabel:k["a"],QIcon:x["a"],QBadge:C["a"],QBtnToggle:y["a"],QSeparator:w["a"],QBtn:_["a"],QTooltip:S["a"]});var Q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row q-mb-md"},[s("q-btn-toggle",{staticClass:"bg-tertiary text-white on-left",attrs:{stretch:"",stylex:"width:200px","toggle-color":"accent-secondary",options:[{label:"All",value:null},{label:"Out",value:0},{label:"Ret",value:1}]},model:{value:t.journeyFilter,callback:function(e){t.journeyFilter=e},expression:"journeyFilter"}}),s("q-input",{staticClass:"row col text-font",attrs:{label:"Search","label-color":"font",filled:"",dense:"",autofocus:""},scopedSlots:t._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:"fad fa-search"}})]},proxy:!0}]),model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),s("q-space"),s("q-select",{staticClass:"on-right",class:{"bd-positive ":t.houseFilter},staticStyle:{width:"200px"},attrs:{"popup-content-class":"bd-font",color:"font",dense:"","emit-value":"","map-options":"",filled:"",options:t.houseOptions,label:"House Filter",clearable:""},model:{value:t.houseFilter,callback:function(e){t.houseFilter=e},expression:"houseFilter"}})],1),s("div",{staticClass:"row q-gutter-xs"},[s("div",{staticClass:"col bg-toolbar"},[s("q-bar",{staticClass:"bg-accent",attrs:{dense:""}},[s("div",{staticClass:"text-black"},[t._v("New")]),s("q-space"),t.newBookings.length>0?s("q-badge",{attrs:{color:"blue-9"}},[t._v("\n          "+t._s(t.newBookings.length)+"\n        ")]):t._e()],1),s("q-scroll-area",{staticStyle:{height:"80vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.newBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-font bg-tertiary q-my-sm",attrs:{group:"new",dense:"",booking:e,stops:t.stops,routes:t.routes},on:{change:t.getBookings}})})),1)],1)],1),s("div",{staticClass:"col-3 bg-toolbar"},[s("q-bar",{staticClass:"bg-orange text-dark",attrs:{dense:""}},[s("div",[t._v("Pending")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"80vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.pendingBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-font bg-tertiary q-my-sm",attrs:{group:"pending",dense:"",booking:e,stops:t.stops,routes:t.routes},on:{change:t.getBookings}})})),1)],1)],1),s("div",{staticClass:"col-3 bg-toolbar"},[s("q-bar",{staticClass:"bg-light-green-5 text-dark",attrs:{dense:""}},[s("div",[t._v("Confirmed To Parents")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"80vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.confirmedBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-font bg-tertiary q-my-sm",attrs:{group:"confirmed",dense:"",booking:e,stops:t.stops,routes:t.routes},on:{change:t.getBookings}})})),1)],1)],1),s("div",{staticClass:"col-2 bg-toolbar row"},[s("div",{staticClass:"full-width column wrap justify-start items-start content-start"},[s("div",{staticStyle:{overflow:"auto","min-width":"100%","max-width":"100%"}},[s("q-bar",{staticClass:"bg-red-14",attrs:{dense:""}},[s("div",[t._v("Cancelled")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"40vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.cancelledBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-font bg-tertiary q-my-sm",attrs:{group:"cancelled",dense:"",booking:e,stops:t.stops,routes:t.routes}})})),1)],1)],1),t.declinedBookings.length>0?s("div",{staticStyle:{overflow:"auto","min-width":"100%","max-width":"100%"}},[s("q-bar",{staticClass:"bg-blue-14 text-white",attrs:{dense:""}},[s("div",[t._v("Declined")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"40vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.declinedBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-white bg-grey-9 q-my-sm",attrs:{group:"declined",dense:"",booking:e,stops:t.stops,routes:t.routes}})})),1)],1)],1):t._e()])])])])},$=[],E=(s("06ef"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col",staticStyle:{"min-width":"500px","min-height":"50vh"}},[s("div",{staticClass:"col-12"},[s("q-select",{ref:"name",attrs:{"map-options":"",dense:"",autofocus:"",clearable:"",outlined:"",options:t.pupilOptions,label:"Pupil Name","content-class":"bg-secondary",dark:"","use-input":"","input-debounce":"0",readonly:t.isEdit},on:{change:function(e){return t.pupilDetails(t.selectedPupil)},input:function(e){return t.pupilDetails(t.selectedPupil)},filter:t.pupilFilter},model:{value:t.selectedPupil,callback:function(e){t.selectedPupil=e},expression:"selectedPupil"}}),t.pupilHouse?s("q-chip",{attrs:{dense:"",icon:"home",size:"10px"}},[t._v(t._s(t.pupilHouse))]):t._e(),t.pupilEmail?s("q-chip",{attrs:{dense:"",icon:"mail",size:"10px"}},[t._v(t._s(t.pupilEmail))]):t._e()],1),s("br"),s("q-tabs",{staticClass:"bg-tertiary text-accent",attrs:{dense:""},model:{value:t.journeyTab,callback:function(e){t.journeyTab=e},expression:"journeyTab"}},[t.isRetOnly?t._e():s("q-tab",{attrs:{name:"out",label:"Outbound"}}),t.isOutOnly?t._e():s("q-tab",{attrs:{name:"ret",label:"Return"}})],1),s("q-tab-panels",{attrs:{animated:""},model:{value:t.journeyTab,callback:function(e){t.journeyTab=e},expression:"journeyTab"}},[s("q-tab-panel",{staticClass:"bg-secondary q-px-xs",attrs:{name:"out"}},[s("h1",{staticClass:"q-mx-none q-pa-xs fullwidth"},[t._v("Destination")]),t.stopsOut.length>0?s("q-select",{ref:"stopOut",attrs:{"map-options":"",outlined:"",dense:"",clearable:"",options:t.stopsOut,label:"To","content-class":"bg-primary","use-input":"","emit-value":"",color:"font","input-debounce":"0"},on:{filter:t.stopOutFilter},model:{value:t.booking.out.stopId,callback:function(e){t.$set(t.booking.out,"stopId",e)},expression:"booking.out.stopId"}}):t._e(),t.stopOutInfo?s("div",[s("p",[t._v(t._s(t.stopOutInfo.cost))])]):t._e()],1),s("q-tab-panel",{staticClass:"bg-secondary q-px-xs",attrs:{name:"ret"}},[s("h1",{staticClass:"q-mx-none q-pa-xs fullwidth"},[t._v("From")]),t.stopsRet.length>0?s("q-select",{ref:"stopRet",attrs:{"map-options":"",outlined:"",dense:"",clearable:"",options:t.stopsRet,label:"From","content-class":"bg-primary",color:"font","use-input":"","emit-value":"","input-debounce":"0"},on:{filter:t.stopRetFilter},model:{value:t.booking.ret.stopId,callback:function(e){t.$set(t.booking.ret,"stopId",e)},expression:"booking.ret.stopId"}}):t._e()],1)],1),s("div",[s("div",{staticClass:"row q-mt-md full-width"},[s("q-btn",{staticClass:"text-accent col",attrs:{disabled:!t.showBottomButtons,size:"large",outlinex:"",xflat:"",color:"accent","text-color":"black",dark:"",icon:"fal fa-check",label:t.isEdit?"Save Changes":"Submit Booking"},nativeOn:{click:function(e){return t.submit(e)}}})],1)])],1)}),T=[],D=s("8b05"),L={name:"TBSCoachBookingNew",props:{bookingToEdit:{type:Object},id:{type:Number},channel:{type:String,default:""}},data(){return{dark:!0,isEdit:!1,isOutOnly:!1,isRetOnly:!1,hasSubmitted:!1,pupilNames:[],pupilOptions:[],journeyTab:"out",selectedPupil:null,pupilHouse:null,pupilEmail:null,stopsOutOptions:[],stopsRetOptions:[],stops:{out:[],ret:[]},booking:{id:null,pupilId:null,sessionId:null,out:{stopId:null},ret:{stopId:null}}}},methods:{submit(){var t=this;this.showBottomButtons&&(this.hasSubmitted=!0,this.$q.loading.show(),this.isEdit?u.putBooking((function(){t.$q.notify("Submitted"),t.$q.loading.hide(),t.$emit("saved")}),(function(){t.$q.notify("Sad Face :("),t.$q.loading.hide()}),this.booking):u.postBooking((function(){t.$q.notify("Submitted"),t.$q.loading.hide(),t.$emit("saved")}),(function(){t.$q.notify("Sad Face :("),t.$q.loading.hide()}),this.booking))},pupilDetails(t){var e=this;this.booking.pupilId=t.value,D["a"].getDetails((function(t){e.pupilHouse=t.boardingHouse,e.pupilEmail=t.email}),null,{id:t.value})},getStudents(){var t=this;D["a"].getNames((function(e){if(t.pupilNames=e.map((function(t){return{value:t.id,label:t.lastname+", "+t.firstname,sublabel:"Millmead"}})),t.bookingToEdit){var s=t.pupilNames.find((function(e){return e.value===t.bookingToEdit.studentId}));t.selectedPupil=t.bookingToEdit?s:null,t.pupilDetails(s)}}))},stopOutFilter(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.stopsOutOptions=s.stopsOut.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.stopsOutOptions=s.stopsOut})},stopRetFilter(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.stopsRetOptions=s.stopsRet.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.stopsRetOptions=s.stopsRet})},pupilFilter(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.pupilOptions=s.pupilNames.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.pupilOptions=s.pupilNames})},pickupFilter(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.pickupOptions=s.pickupOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.pickupOptions=s.pickupLocations})},mergeJourney(t,e){t.stopId=e.stopId},getStops(){var t=this;p["a"].getStops((function(e){t.stops=e}),null,this.booking.sessionId)}},computed:{stopOutInfo(){var t=this,e=this.stops.out.find((function(e){return e.id===t.booking.out.stopId}));return e},stopRetInfo(){var t=this;return this.stops.ret.find((function(e){return e.id===t.booking.ret.stopId}))},showBottomButtons(){return!!this.selectedPupil&&(this.isEdit||this.booking.out.stopId||this.booking.ret.stopId)},stopsOut(){return 0===this.stops.length?[]:this.stops.out.map((function(t){return{value:t.id,label:t.name}}))},stopsRet(){return 0===this.stops.length?[]:this.stops.ret.map((function(t){return{value:t.id,label:t.name}}))}},watch:{},components:{},created(){if(this.bookingToEdit){var t=this.bookingToEdit;this.isEdit=!0,this.booking.sessionId=t.sessionId,this.booking.id=t.id,t.isReturn?(this.isRetOnly=!0,this.mergeJourney(this.booking.ret,t),this.journeyTab="ret"):(this.isOutOnly=!0,this.mergeJourney(this.booking.out,t))}this.getStudents(),this.booking.sessionId=this.$store.getters["transport/activeSession"],this.getStops()}},N=L,z=(s("3fd8"),s("3946")),F=s("4840"),A=s("4776"),j=s("dd08"),P=s("1411"),H=s("1d98"),W=Object(m["a"])(N,E,T,!1,null,"08caf4a6",null),J=W.exports;R()(W,"components",{QSelect:z["a"],QChip:F["a"],QSeparator:w["a"],QTabs:A["a"],QTab:j["a"],QTabPanels:P["a"],QTabPanel:H["a"],QBtn:_["a"]});var M=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-pa-xs q-my-sm bg-tertiary bd-font-secondary"},[s("q-expansion-item",{staticClass:"text-font bg-tertiary",attrs:{group:t.group,dense:""},scopedSlots:t._u([{key:"header",fn:function(){return[1===t.status?s("q-item-section",{staticClass:"flex bg-tertiary",attrs:{avatar:""}},[0===t.booking.isReturn?s("q-icon",{attrs:{color:"white",name:"fal fa-arrow-square-right"}}):t._e(),1===t.booking.isReturn?s("q-icon",{attrs:{name:"fal fa-arrow-square-left",color:"accent"}}):t._e()],1):t._e(),1===t.status?s("q-item-section",[s("q-item-label",[s("div",{staticClass:"row fullwidth"},[t._v("\n            "+t._s(t.booking.displayName)+"\n            "),0===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-right"}}):t._e(),1===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-left"}}):t._e(),t._v("\n            "+t._s(t.booking.stop)+"\n          ")],1)])],1):t._e(),t.status>1?s("q-item-section",[s("q-item-label",[s("div",{staticClass:"row fullwidth"},[t._v("\n            "+t._s(t.booking.displayName)+"\n          ")])]),t.booking.statusId>1?s("q-item-label",{staticClass:"text-font",attrs:{caption:""}},[s("div",{staticClass:"row"},[t._v("\n            "+t._s(t.booking.stop)+"\n            "),0===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-right"}}):t._e(),1===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-left"}}):t._e()],1)]):t._e()],1):t._e(),s("q-item-section",{attrs:{side:""}},[s("div",{staticClass:"row text-font"},[t._v("\n          "+t._s(t.booking.coachCode)+"\n          "),t.booking.statusId<4||6===t.booking.statusId?s("select-button",{staticClass:"q-ml-sm",staticStyle:{"max-width":"20px"},attrs:{size:"xs",icon:"fal fa-bus",title:t.booking.stop,success:t.saveCoach,model:t.booking,field:"coachId",options:t.availiableCoaches,fieldLabel:"Select Coach",color:"tertiary ","text-color":"positive"}}):t._e()],1)])]},proxy:!0}])},[s("q-item-section",{staticClass:"bg-secondary booking-details"},[s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:"grey-7","text-color":"white",label:"Ref"}}),t._v("\n        "+t._s(t.booking.id)+"\n      ")],1),s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:"grey-7","text-color":"white",label:"Route"}}),t._v("\n        "+t._s(t.route.name)+"\n      ")],1),s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:"grey-7","text-color":"white",label:"Stop"}}),t._v("\n        "+t._s(t.stop.name)+"\n      ")],1),t.status>1?s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:0===t.booking.cost?"red":"grey-7","text-color":"white"}},[t._v("\n        Price\n        "),0===t.booking.cost?s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"warning",size:"14px"}}):t._e()],1),t._v("\n        £"+t._s(t.booking.cost)+"\n      ")],1):t._e(),t.status>1?s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs  label",attrs:{color:"grey-4","text-color":"black",label:"Coach"}}),t._v("\n        "+t._s(t.booking.coachCode)+"\n        "),s("select-button",{staticClass:"q-ml-sm",attrs:{size:"sm",icon:"fal fa-bus",title:t.booking.stop,success:t.saveCoach,model:t.booking,field:"coachId",options:t.availiableCoaches,fieldLabel:"Select Coach",color:"tertiary","text-color":"positive"}})],1):t._e(),s("q-btn",{staticClass:"q-ml-md q-mt-md",staticStyle:{width:"80px"},attrs:{size:"sm",dense:"",outline:"",labelx:"Contacts",icon:"fal fa-address-card"}},[s("q-popup-proxy",[s("q-banner",{staticClass:"bg-secondary"},[s("q-list",[s("q-item",[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{color:"font",name:"fal fa-address-card"}})],1),s("q-item-section",[s("p",{staticClass:"text-font q-ma-none"},[t._v(t._s(t.booking.contact.title)+" "+t._s(t.booking.contact.firstName)+" "+t._s(t.booking.contact.lastName))]),s("p",{staticClass:"text-font q-ma-none"},[t._v(t._s(t.booking.contact.email))])])],1)],1)],1)],1)],1),s("q-item-label",{staticClass:"q-mt-sm"},[4!==t.booking.statusId?s("q-bar",{staticClass:"q-mt-md bg-secondary row",staticStyle:{height:"50px"},attrs:{dense:""}},[s("confirm-button",{staticClass:"col",attrs:{size:"10px",label:"",outline:"","text-color":"warning",title:"Cancel Booking?",success:t.cancelBooking,icon:"fal fa-minus"}}),s("q-btn",{staticClass:"col",attrs:{dense:"",outline:"",left:"",icon:"fal fa-edit","text-color":"font",label:"",size:"10px"},on:{click:function(e){return t.editBooking()}}}),1===t.status?s("select-button",{staticClass:"q-ml-sm",attrs:{outline:"",size:"10px",icon:"fal fa-bus",title:t.booking.stop,success:t.saveCoach,model:t.booking,field:"coachId",options:t.availiableCoaches,fieldLabel:"Select Coach","text-color":"positive","text-colorx":"black",label:"assign"}}):t._e(),2===t.status||3===t.status?s("q-btn",{staticClass:"col",attrs:{disabled:!t.booking.cost>0,dense:"",icon:"fal fa-envelope",color:"positive","text-color":"black",size:"10px",label:"confirm"}},[0===t.booking.cost?s("q-tooltip",{attrs:{"content-class":"bg-positive text-black",offset:[10,10]}},[t._v("\n              Set the price to confirm!\n            ")]):t._e(),t.booking.cost>0?s("q-popup-proxy",[s("q-card",{staticClass:"bg-primary bd-font"},[s("q-card-section",[s("div",[t._v("Send Confirmation Email(s)?")])]),s("q-separator",{attrs:{inset:""}}),s("q-card-section",{},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{color:"pink",label:"Confirm"},on:{click:function(e){return t.confirmBooking()}}})],1)],1)],1):t._e()],1):t._e()],1):t._e()],1)],1)],1),s("q-dialog",{ref:"new",attrs:{"content-classes":"new-modal bg-primary bd-font q-pa-md",persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.showEditForm,callback:function(e){t.showEditForm=e},expression:"showEditForm"}},[s("q-card",{staticClass:"edit-booking bg-secondary"},[s("q-toolbar",[s("q-toolbar-title",[t._v("Edit Booking "+t._s(t.booking.id))]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1),s("q-card-section",[s("booking",{key:t.booking.id,attrs:{id:t.booking.id,bookingToEdit:t.booking,channel:"tbs.coaches.bookings"},on:{close:function(e){t.showEditForm=!1},saved:t.emit}})],1)],1)],1)],1)},U=[],G=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-btn",{staticClass:"col",attrs:{unelevated:"",size:t.size,icon:t.icon,outline:t.outline,dense:"","text-color":t.textColor,color:t.color,label:t.label},on:{click:function(t){t.stopPropagation()}}},[t.tooltip?s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t._v("\n     "+t._s(t.tooltip)+"\n   ")]):t._e(),s("q-popup-proxy",{ref:"popup",attrs:{persistent:""}},[s("q-card",{staticClass:"bg-secondary ada-card",attrs:{dark:""}},[s("q-card-section",[t._v("\n        "+t._s(t.title)+"\n      ")]),s("q-separator",{attrs:{dark:"",inset:""}}),s("q-card-section",{},[s("q-select",{attrs:{"emit-value":"","map-options":"",dark:"",filled:"",options:t.options,fieldLabel:t.label},model:{value:t.model[t.field],callback:function(e){t.$set(t.model,t.field,e)},expression:"model[field]"}}),s("br"),s("div",{staticClass:"row"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col q-mr-xs",attrs:{"text-color":"font",color:"tertiary",unelevated:"",label:"Close"}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col q-ml-xs",attrs:{"text-color":"font",color:"positive",outline:"",unelevated:"",disabled:!t.model[t.field],label:t.buttonLabel},on:{click:function(e){return t.success(t.model)}}})],1)],1)],1)],1)],1)},Y=[],K={name:"Component.Buttons.New",props:{success:{type:Function,required:!0},model:{type:Object,required:!0},options:{type:Array,required:!0},field:{type:String,required:!0},size:{type:String,default:"xs"},icon:{type:String,default:"fal fa-edit"},title:{type:String,default:""},fieldLabel:{type:String,default:""},type:{type:String,default:""},tooltip:{type:String},color:{type:String,default:"primary"},label:{type:String,default:""},buttonLabel:{type:String,default:"Save"},textColor:{type:String,default:""},outline:{type:Boolean}},data(){return{}},methods:{},computed:{},components:{},created(){}},V=K,X=(s("52f0"),s("8c18")),Z=s("ebe6"),tt=s("965d"),et=s("58c0"),st=Object(m["a"])(V,G,Y,!1,null,"d8754be4",null),ot=st.exports;R()(st,"components",{QBtn:_["a"],QTooltip:S["a"],QPopupProxy:X["a"],QCard:Z["a"],QCardSection:tt["a"],QSeparator:w["a"],QSelect:z["a"]}),R()(st,"directives",{ClosePopup:et["a"]});var it=s("30bd"),at={name:"CoachBookingCard",props:{booking:{type:Object,required:!0},stops:{type:Object,required:!0},routes:{type:Array,required:!0},group:{type:String,required:!0}},data(){return{showEditForm:!1,bookingId:null,currentBooking:null}},methods:{saveCoach(){u.putCoachAssignment(this.emit,null,this.booking)},confirmBooking(){u.putConfirmBooking(this.emit,null,this.booking)},cancelBooking(){u.deleteBooking(this.emit,null,this.booking.id)},declineBooking(){u.declineBooking(this.emit,null,this.booking.id)},editBooking(){this.currentBookingId=this.booking.id,this.showEditForm=!0,this.currentBooking=this.booking},emit(){this.showEditForm=!1,this.$emit("change")}},computed:{status(){return this.booking.statusId},taxiCompanyName(){var t=this.booking.taxiId,e=this.taxiCompanies.find((function(e){return e.value===t}));return e?e.label:"ERROR"},route(){var t=this.booking.routeId,e=this.routes.find((function(e){return e.id===t}));return e||"ERROR"},stop(){var t=this.booking.stopId,e=1===this.booking.isReturn?this.stops.ret:this.stops.out;if(!e)return{};var s=e.find((function(e){return e.id===t}));return s||!1},availiableCoaches(){return this.stop?this.stop.coaches.map((function(t){return{value:t.id,label:t.code+" ["+t.spacesLeft+" spaces]"}})):[]}},components:{Booking:J,SelectButton:ot,ConfirmButton:it["a"]},created(){}},nt=at,rt=(s("3922"),s("0f3b")),lt=s("01a4"),ct=s("5d16"),ut=s("e81c"),dt=s("eb05"),pt=s("f85a"),ht=Object(m["a"])(nt,M,U,!1,null,"5000002c",null),gt=ht.exports;R()(ht,"components",{QExpansionItem:rt["a"],QItemSection:q["a"],QIcon:x["a"],QItemLabel:k["a"],QBadge:C["a"],QBtn:_["a"],QPopupProxy:X["a"],QBanner:lt["a"],QList:f["a"],QItem:v["a"],QBar:ct["a"],QTooltip:S["a"],QCard:Z["a"],QCardSection:tt["a"],QSeparator:w["a"],QDialog:ut["a"],QToolbar:dt["a"],QToolbarTitle:pt["a"]}),R()(ht,"directives",{ClosePopup:et["a"]});var mt={name:"Coaches.Home",props:{},data(){return{rawBookings:[],stops:{},routes:[],search:"",showEditForm:!1,currentBookingId:null,currentBooking:null,houseFilter:null,session:null,journeyFilter:null}},methods:{getBookings(){var t=this;this.getStops(),this.getRoutes(),u.getAllBookings((function(e){t.rawBookings=e}),null)},getStops(){var t=this;p["a"].getStops((function(e){t.stops=e}),this.$error,this.session)},getRoutes(){var t=this;p["a"].getRoutes((function(e){t.routes=e}),this.$error,this.session)},initialise(){var t=this.$store.getters["transport/activeSession"];this.session=t,t&&this.$wampSubscribe("coaches"+t,this.getBookings),this.getBookings()}},computed:{houseOptions(){return this.$parseOptions(this.rawBookings,"house")},bookings(){var t=this,e=this.search,s=this.rawBookings;return null!==this.journeyFilter&&(s=s.filter((function(e){return e.isReturn===t.journeyFilter}))),this.houseFilter&&(s=s.filter((function(e){return e.house===t.houseFilter}))),""===e?s:s.filter((function(t){return t.displayFrom.toLowerCase().indexOf(e)>-1||t.displayTo.toLowerCase().indexOf(e)>-1||t.displayName.toLowerCase().indexOf(e)>-1}))},newBookings(){return this.bookings.filter((function(t){return 1===t.statusId||!t.coachId}))},pendingBookings(){return this.bookings.filter((function(t){return 2===t.statusId}))},confirmedBookings(){return this.bookings.filter((function(t){return 3===t.statusId||6===t.statusId}))},cancelledBookings(){return this.bookings.filter((function(t){return 4===t.statusId}))},declinedBookings(){return this.bookings.filter((function(t){return 5===t.statusId}))}},components:{Booking:J,BookingCard:gt,ConfirmButton:it["a"]},created(){var t=this;this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.getBookings),this.initialise()}},bt=mt,ft=(s("918e"),s("bc74")),vt=s("f962c"),qt=s("26a8"),kt=Object(m["a"])(bt,Q,$,!1,null,"1660655f",null),xt=kt.exports;R()(kt,"components",{QBtnToggle:y["a"],QInput:ft["a"],QIcon:x["a"],QSpace:vt["a"],QSelect:z["a"],QBar:ct["a"],QBadge:C["a"],QScrollArea:qt["a"],QList:f["a"]});var Ct=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row no-wrap q-px-md q-pt-md text-left"},[s("div",{staticClass:"q-mr-md",staticStyle:{"min-width":"200px"}},[s("q-scroll-area",{staticStyle:{height:"90vh"}},[s("q-btn-toggle",{staticClass:"bg-tertiary text-white q-mb-md",attrs:{stylex:"width:200px","toggle-color":"accent-secondary",options:[{label:"Out",value:0},{label:"Return",value:1}]},on:{click:t.setTopActive},model:{value:t.isReturn,callback:function(e){t.isReturn=e},expression:"isReturn"}}),s("q-list",{staticClass:"no-padding"},t._l(t.routeOptions,(function(e){return s("q-item",{key:e.value,staticClass:"q-pa-xs text-white bgx-grey-8 bg-tertiary q-my-xs",class:e.value===t.selectedRouteId?"active-route":"",staticStyle:{border:"1px solid grey"},attrs:{clickable:"",group:"routes",dense:"","expand-separatorx":""},on:{click:function(s){return t.setRoute(e.value)}}},[s("q-item-section",{attrs:{top:""}},[s("q-item-label",{staticClass:"row"},[s("div",{staticClass:"col text-h7 text-bold text-accent q-mt-xs"},[s("span",{staticClass:"q-mr-md"},[t._v(t._s(e.label))])])])],1),s("q-item-section",{attrs:{side:""}},[s("div",{staticClass:"row"},[e.supervisorAlert||e.alert?t._e():s("q-icon",{staticClass:"col q-ml-xs",attrs:{size:"xs",name:"fal fa-check",color:"accent"}}),e.supervisorAlert?s("q-icon",{staticClass:"col q-ml-xs",attrs:{size:"xs",name:"fal fa-user-graduate",color:"warning"}},[s("q-tooltip",[t._v("\n                    One or more coaches are not assigned supervisors\n                  ")])],1):t._e(),e.alert?s("q-icon",{staticClass:"col q-ml-xs",attrs:{size:"xs",name:"fal fa-exclamation-circle",color:"warning"}},[s("q-tooltip",[t._v("\n                   One or more bookings are not assigned coaches\n                  ")])],1):t._e()],1)])],1)})),1)],1)],1),s("div",{staticClass:"col"},[s("div",{staticClass:"row q-ml-md"},t._l(t.selectedRoute.stops,(function(e){return 0===e.isSchoolLocation?s("q-btn",{key:e.id,staticClass:"q-mr-xs",attrs:{color:e.color,label:e.name,size:"sm",densex:""}}):t._e()})),1),s("div",{staticClass:"row"},[s("q-scroll-area",{staticClass:"col row",staticStyle:{height:"80vh"},attrs:{horizontal:"",visible:"","bar-style":{background:"grey"},"thumb-style":{background:"white",opacity:1}}},[s("div",{staticClass:"row no-wrap"},t._l(t.selectedRoute.coaches,(function(e){return s("coach",{key:e.id,staticClass:"col",attrs:{coach:e,stops:t.selectedRoute.stops},on:{change:t.getRoutes}})})),1)]),s("unassigned",{attrs:{bookings:t.unassignedBookings,stops:t.selectedRoute.stops},on:{change:t.getRoutes}})],1)])])},yt=[],wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-ma-md ada-coach"},[s("q-bar",{staticClass:"text-font bg-tertiary q-mb-xs",staticStyle:{overflow:"hidden","text-overflow":"ellipses","white-space":"nowrap"},style:{width:t.containerWidth+"px",minWidth:t.containerWidth+"px"}},[s("span",{staticClass:"text-font"},[t._v(t._s(t.coach.code))]),s("q-space"),s("confirm-button",{staticClass:"bg-tertiary no-shadow",staticStyle:{"max-width":"30px"},attrs:{flat:"",title:"Send Registration Email To Supervisor?",success:t.sendRegisterEmail,"text-color":"accent",icon:"fal fa-tasks",tooltip:"Send registration email to supervisors"}}),t.coach.alert?s("q-icon",{staticClass:"q-ml-xs",attrs:{size:"xs",name:"fal fa-exclamation-circle",color:"positive"}}):t._e()],1),s("q-bar",{staticClass:"text-font bg-tertiary q-mb-xs q-pr-xs row",style:{width:t.containerWidth+"px",minWidth:t.containerWidth+"px"}},[s("q-btn",{staticClass:"q-mr-sm",attrs:{icon:"fal fa-user-graduate",dense:"",size:"xs","text-color":"accent",flat:""}},[s("q-tooltip",[t._v("\n          Select supervisor\n        ")]),s("q-popup-proxy",{ref:"sup"},[s("q-banner",{staticClass:"bg-tertiary bd-font-secondary"},[s("div",{staticClass:"row"},[s("users",{ref:"users",attrs:{label:"Supervisor",id:t.coach.supervisorId},on:{change:t.saveSupervisor}})],1)])],1)],1),s("span",{staticClass:"col",staticStyle:{"font-size":"12px",overflow:"hidden","text-overflow":"ellipses","white-space":"nowrap"}},[t._v(t._s(t.coach.supervisor.displayName))])],1),s("q-bar",{staticClass:"text-font bg-tertiary q-mb-xs",staticStyle:{height:"20px"}},t._l(t.coach.stops,(function(e){return 0===e.isSchoolLocation&&e.isActive?s("q-badge",{key:e.id,staticStyle:{height:"5px"},attrs:{icon:"far fa-plus",color:t.stopColor(e.id)}}):t._e()})),1),s("div",{directives:[{name:"mutation",rawName:"v-mutation",value:t.handler,expression:"handler"}],staticClass:"drop-target rounded-borders overflow-hidden bg-tertiary",style:{height:t.containerHeight+"px",width:t.containerWidth+"px",minWidth:t.containerWidth+"px"},attrs:{id:"coach_"+t.coach.id},on:{dragenter:t.onDragEnter,dragleave:t.onDragLeave,dragover:t.onDragOver,drop:t.onDrop}},[t._l(t.noSeats,(function(e){return s("div",{key:e,staticClass:"box bg-secondary",staticStyle:{border:"none"},style:{height:t.boxDims+"px",width:t.boxDims+"px"},attrs:{id:"protected",protected:"true"}})})),t._l(t.coach.bookings,(function(e){return s("div",{key:e.id,staticClass:"box border-toolbar flex items-center justify-center",class:"bg-"+t.stopColor(e.stopId),staticStyle:{"font-size":"12px","font-weight":"bold"},style:{height:t.boxDims+"px",width:t.boxDims+"px"},attrs:{id:e.id,draggable:"true"},on:{dragstart:t.onDragStart}},[t._v(t._s(e.schoolNumber)+"\n        "),s("q-tooltip",{staticClass:"bg-primary bd-font"},[t._v("\n          "+t._s(e.displayName)+" "),s("br"),t._v("\n          "+t._s(e.house)+"\n        ")])],1)}))],2)],1)},_t=[],St=s("85b2"),Bt={props:{coach:{type:Object,required:!0},stops:{type:Array,required:!0}},data(){return{status:[],boxDims:50,columns:4}},methods:{sendRegisterEmail(t){var e=this;p["a"].postRegisterEmail((function(t){e.$q.notify("Sent")}),this.$errorHandler,this.coach.id)},emit(){this.$emit("change")},assignCoach(t){var e={id:t,coachId:this.coach.id};u.putCoachAssignment(this.emit,null,e)},saveSupervisor(t){var e=this;p["a"].putSupervisor((function(){e.$refs.sup.hide(),e.coach.supervisor=t,e.emit()}),this.$error,this.coach.id,t.id)},stopColor(t){var e=this.stops.find((function(e){return e.id===t}));return e.color},handler(t){for(var e in this.status1=[],t){var s=t[e];this.status.push(s)}},onDragStart(t){var e=t.target.id,s=this.coach.bookings.find((function(t){return t.id===parseInt(e)}));t.dataTransfer.setData("bookingId",e),t.dataTransfer.setData("stopId",s.stopId),t.dataTransfer.dropEffect="move"},onDragEnter(t){!0!==t.target.draggable&&"protected"!==t.target.id&&t.target.classList.add("drag-enter")},onDragLeave(t){t.target.classList.remove("drag-enter")},onDragOver(t){t.preventDefault()},onDrop(t){t.preventDefault();var e=t.target;!0!==t.target.draggable&&"protected"!==t.target.id||(e=document.getElementById("coach_"+this.coach.id));var s=t.dataTransfer.getData("bookingId"),o=parseInt(t.dataTransfer.getData("stopId")),i=document.getElementById(s);if(i.parentNode!==t.target){var a=this.coach.stops.find((function(t){return t.id===o&&t.isActive}));a&&(i.parentNode.removeChild(i),e.appendChild(i),this.assignCoach(s)),e.classList.remove("drag-enter")}else t.target.classList.remove("drag-enter")}},computed:{size(){return this.coach.capacity},bookings(){return[{id:1},{id:2}]},containerWidth(){return 4*this.boxDims},containerHeight(){var t=Math.floor(this.size/this.columns)+1;return t*this.boxDims},noSeats(){var t=this.size%this.columns;return t},supervisorEmail(){return""}},created(){console.log(this.coach)},components:{Users:St["a"],ConfirmButton:it["a"]}},Rt=Bt,It=(s("cfd2"),s("57b8")),Ot=Object(m["a"])(Rt,wt,_t,!1,null,"3cd5468a",null),Qt=Ot.exports;R()(Ot,"components",{QBar:ct["a"],QSpace:vt["a"],QIcon:x["a"],QBtn:_["a"],QTooltip:S["a"],QPopupProxy:X["a"],QBanner:lt["a"],QBadge:C["a"]}),R()(Ot,"directives",{ClosePopup:et["a"],Mutation:It["a"]});var $t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-ma-md q-pl-sm",staticStyle:{"border-left":"1px solid grey"}},[s("q-bar",{staticClass:"text-font bg-tertiary q-mb-xs"},[t._v("Unassigned")]),s("div",{directives:[{name:"mutation",rawName:"v-mutation",value:t.handler,expression:"handler"}],staticClass:"drop-target rounded-borders overflow-hidden bg-tertiary q-mt-xs",style:{height:t.containerHeight+"px",width:t.containerWidth+"px",minWidth:t.containerWidth+"px"},attrs:{id:"unassigned"},on:{dragenter:t.onDragEnter,dragleave:t.onDragLeave,dragover:t.onDragOver,drop:t.onDrop}},t._l(t.bookings,(function(e){return s("div",{key:e.id,staticClass:"box border-toolbar flex items-center justify-center",class:"bg-"+t.stopColor(e.stopId),staticStyle:{"font-size":"12px","font-weight":"bold"},style:{height:t.boxDims+"px",width:t.boxDims+"px"},attrs:{id:e.id,draggable:"true"},on:{dragstart:t.onDragStart}},[t._v(t._s(e.schoolNumber)+"\n        "),s("q-tooltip",{staticClass:"bg-primary bd-font"},[t._v("\n          "+t._s(e.displayName)+" "),s("br"),t._v("\n          "+t._s(e.house)+"\n        ")])],1)})),0)],1)},Et=[],Tt={props:{bookings:{type:Array,required:!0},stops:{type:Array,required:!0}},data(){return{status:[],boxDims:50,columns:4}},methods:{emit(){this.$emit("change")},assignCoach(t){var e={id:t,coachId:0};u.putCoachAssignment(this.emit,null,e)},stopColor(t){var e=this.stops.find((function(e){return e.id===t}));return e.color},handler(t){for(var e in this.status1=[],t){var s=t[e];this.status.push(s)}},onDragStart(t){var e=t.target.id,s=this.bookings.find((function(t){return t.id===parseInt(e)}));t.dataTransfer.setData("bookingId",e),t.dataTransfer.setData("stopId",s.stopId),t.dataTransfer.dropEffect="move"},onDragEnter(t){!0!==t.target.draggable&&"protected"!==t.target.id&&t.target.classList.add("drag-enter")},onDragLeave(t){t.target.classList.remove("drag-enter")},onDragOver(t){t.preventDefault()},onDrop(t){t.preventDefault();var e=t.target;!0!==t.target.draggable&&"protected"!==t.target.id||(e=document.getElementById("coach_"+this.coach.id));var s=t.dataTransfer.getData("bookingId"),o=document.getElementById(s);o.parentNode!==t.target?(o.parentNode.removeChild(o),e.appendChild(o),e.classList.remove("drag-enter"),this.assignCoach(s)):t.target.classList.remove("drag-enter")}},computed:{size(){return this.bookings.length},containerWidth(){return 4*this.boxDims},containerHeight(){var t=Math.floor(this.size/this.columns)+1;return t*this.boxDims},noSeats(){var t=this.size%this.columns;return console.warn(t),t}}},Dt=Tt,Lt=(s("1c33"),Object(m["a"])(Dt,$t,Et,!1,null,"4e1c9fce",null)),Nt=Lt.exports;R()(Lt,"components",{QBar:ct["a"],QTooltip:S["a"]}),R()(Lt,"directives",{Mutation:It["a"]});var zt={data(){return{isReturn:0,routes:[],selectedRouteId:null,selectedRoute:{id:null,name:null},unassignedBookings:[],session:[]}},methods:{getRoutes(){p["a"].getRoutes(this.processRoutes,null,this.session)},processRoutes(t){this.routes=t,this.selectedRouteId?this.setRoute(this.selectedRouteId):this.setTopActive()},setTopActive(){var t=this.routeOptions[0];if(!t)return this.selectedRouteId=null,void(this.selectedRoute=null);this.selectedRouteId=t.value,this.setRoute(t.value)},setRoute(t){this.selectedRouteId=t,p["a"].getRoute(this.processRoute,this.$error,this.selectedRouteId)},processRoute(t){this.selectedRoute=t;var e=this;this.selectedRoute.stops.forEach((function(t,s,o){e.selectedRoute.stops[s].color=e.$palette(s)})),this.unassignedBookings=t.unassigned}},computed:{routesOut(){return this.routes.filter((function(t){return 0===t.isReturn}))},routeOptions(){var t=this,e=this.routes.filter((function(e){return e.isReturn===t.isReturn}));return e.map((function(t){return{value:t.id,label:t.name,alert:t.alert,supervisorAlert:t.supervisorAlert}}))}},created(){var t=this;0!==this.session&&(this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.setSession),this.session=this.$store.getters["transport/activeSession"]),this.getRoutes(),this.session=this.$store.getters["transport/activeSession"],this.$wampSubscribe("coaches"+this.session,this.getRoutes),this.$wampSubscribe("routes"+this.session,this.getRoutes)},components:{Coach:Qt,Unassigned:Nt}},Ft=zt,At=(s("8e14"),Object(m["a"])(Ft,Ct,yt,!1,null,"4c915e2f",null)),jt=At.exports;R()(At,"components",{QScrollArea:qt["a"],QBtnToggle:y["a"],QList:f["a"],QItem:v["a"],QItemSection:q["a"],QItemLabel:k["a"],QBadge:C["a"],QIcon:x["a"],QTooltip:S["a"],QBtn:_["a"]});var Pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticStyle:{"max-width":"600px"}},[s("q-tabs",{staticClass:"bg-tertiary text-font shadow-2 q-mb-md",attrs:{"inline-label":""},model:{value:t.isReturn,callback:function(e){t.isReturn=e},expression:"isReturn"}},[s("q-tab",{attrs:{name:"0",label:"Outbound"}}),s("q-tab",{attrs:{name:"1",label:"Return"}})],1),s("div",{staticClass:"full-width"},[s("q-list",{staticClass:"rounded-borders",attrs:{bordered:""}},[s("q-expansion-item",{attrs:{"expand-separator":"",icon:"perm_identity",label:"Account settings",caption:"John Doe"}},[s("q-list",{attrs:{bordered:"",padding:""}},t._l(t.bookings,(function(e){return s("div",{key:e.id},[s("q-item",{attrs:{dense:""}},[s("q-item-section",[s("q-item-label",[t._v(t._s(e.displayName))]),0===e.isReturn?s("q-item-label",{staticClass:"text-font-secondary",attrs:{overline:""}},[t._v(t._s(e.schoolLocation)+" "),s("q-icon",{attrs:{name:"fa fa-arrow-right"}}),t._v(" "+t._s(e.stop))],1):t._e(),1===e.isReturn?s("q-item-label",{staticClass:"text-font-secondary",attrs:{overline:""}},[t._v(t._s(e.stop)+" "),s("q-icon",{attrs:{name:"fa fa-arrow-right"}}),t._v(" "+t._s(e.schoolLocation))],1):t._e()],1),s("q-item-section",{attrs:{side:""}},[s("q-btn-toggle",{staticClass:"toggle",attrs:{spread:"","no-caps":"",unelevated:"","toggle-color":"tertiary",color:"accent","text-color":"dark",options:[{label:"No",value:0},{label:"Yes",value:1}]},on:{input:function(e){return t.registerStudent(t.student)}},model:{value:e.isRegistered,callback:function(s){t.$set(e,"isRegistered",s)},expression:"booking.isRegistered"}})],1)],1),s("q-separator",{attrs:{spaced:""}})],1)})),0)],1)],1)],1)],1)},Ht=[],Wt={name:"Page.Coaches.Register",props:{},data(){return{isReturn:"0",rawBookings:[],stops:{},routes:[],search:"",currentBookingId:null,currentBooking:null,session:null}},methods:{getBookings(){var t=this;this.getStops(),this.getRoutes(),u.getAllBookings((function(e){t.rawBookings=e}),null)},getStops(){var t=this;p["a"].getStops((function(e){t.stops=e}),this.$error,this.session)},getRoutes(){var t=this;p["a"].getRoutes((function(e){t.routes=e,console.log(e)}),this.$error,this.session)},initialise(){var t=this.$store.getters["transport/activeSession"];this.session=t,t&&this.$wampSubscribe("coaches"+t,this.getBookings),this.getBookings()}},computed:{bookings(){var t=this.search,e=parseInt(this.isReturn),s=this.rawBookings.filter((function(t){return t.isReturn===e}));return""===t?s:s.filter((function(e){return e.displayFrom.toLowerCase().indexOf(t)>-1||e.displayTo.toLowerCase().indexOf(t)>-1||e.displayName.toLowerCase().indexOf(t)>-1}))},confirmedBookings(){return this.bookings.filter((function(t){return 3===t.statusId||6===t.statusId}))},coaches(){return 3}},components:{},created(){var t=this;this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.getBookings),this.initialise()}},Jt=Wt,Mt=(s("2aae8"),Object(m["a"])(Jt,Pt,Ht,!1,null,"159a2678",null)),Ut=Mt.exports;R()(Mt,"components",{QPage:b["a"],QTabs:A["a"],QTab:j["a"],QList:f["a"],QExpansionItem:rt["a"],QItem:v["a"],QItemSection:q["a"],QItemLabel:k["a"],QIcon:x["a"],QBtnToggle:y["a"],QSeparator:w["a"]});var Gt=s("423b"),Yt={name:"PageTransportCoaches",data(){return{elements:[{name:"checklist",component:O,icon:"fal fa-tasks",shortcut:"b",count:0,tooltip:"Check List"},{name:"home",component:xt,icon:"fal fa-poll-people",shortcut:"b",count:0,tooltip:"Bookings Grid"},{name:"coaches",labelx:"coaches",component:jt,icon:"fal fa-bus",shortcut:"c",tooltip:"Organise Coaches"},{name:"routes",labelx:"routes",icon:"fal fa-route",component:Gt["a"],shortcut:"s",tooltip:"Route Settings"},{name:"register",labelx:"routes",icon:"fal fa-th-list",component:Ut,shortcut:"s",tooltip:"register"}]}},components:{toolbarPage:a["a"]},methods:{newCount(){var t=this;u.getNewCount((function(e){var s=t.elements.find((function(t){return"home"===t.name}));s.count=e}),null)},counts(){var t=this.$store.getters["transport/activeSession"];this.$wampSubscribe("coaches"+t,this.newCount),this.newCount()}},created(){var t=this;this.counts(),this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.counts)}},Kt=Yt,Vt=Object(m["a"])(Kt,o,i,!1,null,null,null);e["default"]=Vt.exports},fe84:function(t,e,s){}}]);